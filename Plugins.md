#### ⚠️ WARNING: this API is deep under construction.

## How to create KeeWeb plugin

Install keeweb-plugin package. It will guide you through plugin creation:
```bash
$ npm i -g keeweb-plugin
```

Don't want to install it? [Here](https://github.com/keeweb/keeweb/blob/develop/plugins/keeweb-plugin/keeweb-plugin.js)'s the script, you can just download it.

This command will generate all files necessary to develop and distribute the plugin:

```bash
$ keeweb-plugin create
```

Important: it will generate a private key for your plugin, you have to keep it securely, to be able to update your plugin later.  
To sign the resources inside your plugin and update the manifest, use this:  

```bash
$ keeweb-plugin sign my-awesome-plugin
```

After it, you can test your plugin and make it public.

## Testing your plugin

Host your plugin somewhere, for example:
```bash
$ npm i -g http-server
$ http-server -c-1 --cors -p8081 -S
Starting up http-server, serving ./
Available on:
  https://127.0.0.1:8081
```

Please note that plugins muse be hosted on HTTPS server.  
Now add your plugin to KeeWeb with this url: `https://127.0.0.1:8081`.

## Scripts and examples

Plugin examples: https://github.com/keeweb/keeweb/tree/develop/plugins/examples  
- [basic feature, js+css](https://github.com/keeweb/keeweb/tree/develop/plugins/examples/psychodelic)
- [theme](https://github.com/keeweb/keeweb/tree/develop/plugins/examples/rainbow-theme)
- [locale](https://github.com/keeweb/keeweb/tree/develop/plugins/examples/square-language)
- [storage](https://github.com/keeweb/keeweb/tree/develop/plugins/examples/fail-storage)

## Manifest

All plugins must have `manifest.json`. This file is generated by keeweb plugin generator script.
Typical structure:

```js
{
  "version": "0.0.1",
  "manifestVersion": "0.1.0",
  "name": "my-awesome-plugin",
  "description": "My asweome plugin",
  "author": {
    "name": "user",
    "email": "user@example.com",
    "url": "http://example.com"
  },
  "licence": "MIT",
  "url": "https://example.com/about_my_plugin",
  "resources": {
    "js": "<signature>",
    "css": "<signature>"
  },
  "publicKey": "<public_key>"
}
```

Locale plugins have additional section in manifest:

```js
{
  ...other fields
  "resources": {
    "loc": "<signature>"
  },
  "locale": {
    "name": "nl-NL",
    "title": "Nederlands"
  }
}
```

As well as theme plugins:

```js
{
  ...other fields
  "resources": {
    "css": "<signature>"
  },
  "theme": {
    "name": "rainbow",
    "title": "Rainbow"
  }
}
```

Theme class name will be `th-rainbow` in this case.

## Plugin contents

Plugin can contain other files, depending on plugin type:

- JS:
  - `plugin.js`
- JS+CSS:
  - `plugin.js`
  - `plugin.css`
- CSS:
  - `plugin.css`
- Themes:
  - `plugin.css`
- Locales:
  - `<locale_name>.json`

There's no possibility to customize script and style name. However you can use any builder to make output `plugin.js` and `plugin.css` files.

## JS API

Plugins can use `require` and `module.exports`.  
Example plugin script:

```js
// you can use all KeeWeb modules
var _ = require('underscore');
var kdbxweb = require('kdbxweb');
var DetailView = require('views/details/details-view');

module.exports.uninstall = function() {
  // It's necessary to have this function
  // Cleanup all plugin resources and overrides here
};
```

There's no public API, later it could be created for some common extension points, like fields, storages and so on. Now you can just override or extend KeeWeb modules.

## Guidelines

- ❗️ DO NOT obfuscate, uglify, etc... plugin code, including styles and locales: it must be easy to read and review  
&rarr; uglified plugins will be marked as dangerous  
- initialization should not take long, it's better to lazy-load stuff  
&rarr; users will be able to see slow plugins  
- take everything with you, don't read resources from network  
&rarr; such plugins will be marked as dangerous  
- revert all changes in uninstall function  
- use common sense: KeeWeb has no plugin API, plugins extend KeeWeb by augmenting its functions; don't go crazy, to be able to maintain your plugin in new versions, if you feel that something is too hard to extend, it's better to submit a PR or ask for a feature  
- think about compatibility: kdbx format must be compatible with KeePass